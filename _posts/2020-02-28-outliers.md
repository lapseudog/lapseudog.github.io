---
layout: post
author: lapseudog
---
# How are performing common outliers detection techniques with real data?
Common outliers detection techniques are usually illustrated with the Normal distribution, however the data is not always distributed that way. While the behaviour of the Normal distribution is usually well known, the other distribution while they are known they are much less common.  Hence errors are probably made, but really how much of an error is made? Several outliers detection techniques will be selected, and tested against univariate data normally distributed; and then these results compared against data which is not drawn from Normal distribution. 
A few outliers detection techniques have been selected, because I have seen them in several vendors solutions and been discussed on several web pages. Generally these techniques involve selecting a central point of the data, and measuring the distance from the central point by a dispersion measure. As the purpose is to provide a measure, techniques based on visual inspection are not used.
## Outliers detection techniques
The techniques are:
* Mean and standard deviation, also known as the z-score. The central point of the data is the arithmetic mean, and the measure of dispersion is the standard deviation. 
* Median and Median Absolute Deviation. The central point of the data is the median (or 50th percentile), and the measure of dispersion is the Median Absolute Deviation.
* Median and interquartile range (also known as interquartile deviation) method. The central point is the median, and the interquartile range is the measure of dispersion.

## Measuring the impact
For data taken a normal distribution the relation between the number of standard deviation and the percentile rank is known. So for the purpose of comparison letâ€™s use the percentile rank associated with the Normal distribution as or gold standard. 
## Results with common distributions

|Distribution | Rank of mean +2 SD| Rank of mean +3 SD|Rank of MAD +2| Rank of MAD +3|Rank of IQD +2| Rank of IQD +3|
|--- |--- |--- |--- |--- |--- |--- |
Normal Distribution |  97.728 |  99.866 | 91.141 |  97.852 | 99.654 |  99.997 |
std Exponential |  95.017 |  98.173 | 80.897 |  88.188 | 94.434 |  98.150 |
Exponential 0.5 |  95.023 |  98.173 | 80.910 |  88.209 | 94.452 |  98.156 |
Exponential 2.0 |  95.020 |  98.168 | 80.895 |  88.190 | 94.440 |  98.146 |
Exponential 0.1 |  95.026 |  98.170 | 80.894 |  88.185 | 94.459 |  98.153 |
Gamma shp .1 |  96.223 |  97.770 | 55.797 |  57.427 | 80.198 |  83.239 |
Gamma shp .5 |  94.964 |  97.797 | 74.449 |  80.918 | 91.118 |  95.756 |
Gamma shp 1 |  95.026 |  98.164 | 80.920 |  88.201 | 94.445 |  98.141 |
Gamma shp 3 |  95.578 |  98.825 | 85.686 |  93.114 | 97.171 |  99.495 |
Gamma shp 5 |  95.902 |  99.074 | 86.934 |  94.318 | 97.871 |  99.719 |
Gamma shp 10 |  96.319 |  99.326 | 88.186 |  95.442 | 98.497 |  99.870 |
Power shp .01 |  98.113 |  98.491 | 50.552 |  50.697 | 75.522 |  75.832 |
Power shp .1 |  93.070 |  96.299 | 55.797 |  57.428 | 80.439 |  83.758 |
Power shp .5 |  96.428 |  100.000 | 82.632 |  94.838 | 100.000 |  100.000 |
Power shp 1 |  100.000 |  100.000 | 99.966 |  100.000 | 100.000 |  100.000 |
Power shp 5 |  100.000 |  100.000 | 100.000 |  100.000 | 100.000 |  100.000 |
Power shp 10 |  100.000 |  100.000 | 100.000 |  100.000 | 100.000 |  100.000 |
Power shp 100 |  100.000 |  100.000 | 100.000 |  100.000 | 100.000 |  100.000 |
Beta 0.5 0.5 |  100.000 |  100.000 | 100.000 |  100.000 | 100.000 |  100.000 |
Beta 1 1 |  100.000 |  100.000 | 100.000 |  100.000 | 100.000 |  100.000 |
Beta 1 3 |  95.230 |  99.516 | 84.996 |  93.589 | 98.677 |  100.000 |
Beta 2 2 |  99.198 |  100.000 | 93.722 |  100.000 | 100.000 |  100.000 |
Beta 2 5 |  96.138 |  99.653 | 87.995 |  95.958 | 99.221 |  100.000 |
Beta 5 1 |  100.000 |  100.000 | 100.000 |  100.000 | 100.000 |  100.000 |
biNormal 3-6 1,1.5 |  97.393 |  99.917 | 88.794 |  97.943 | 99.900 |  100.000 |

## Code
```python
import numpy as np
from scipy import stats

def GetOutlierRanks(cdist):
    cMean = np.mean(cdist[0])
    cSD = np.std(cdist[0])
    cM2SD = cMean + 2.0 * cSD
    cM3SD = cMean + 3.0 * cSD
    cMAD = stats.median_absolute_deviation(cdist[0], scale=1)
    cMedian = np.median(cdist[0])
    c25pctl = np.percentile(cdist[0], 25, interpolation='linear')
    c75pctl = np.percentile(cdist[0], 75, interpolation='linear')
    cIQD = np.abs(c75pctl - c25pctl)
    rankM2SD = stats.percentileofscore(cdist[0], cM2SD)
    rankM3SD = stats.percentileofscore(cdist[0], cM3SD)
    rankM2MAD = stats.percentileofscore(cdist[0], cMedian + 2.0 * cMAD)
    rankM3MAD = stats.percentileofscore(cdist[0], cMedian + 3.0 * cMAD)
    rankM2IQD = stats.percentileofscore(cdist[0], cMedian + 2.0 * cIQD)
    rankM3IQD = stats.percentileofscore(cdist[0], cMedian + 3.0 * cIQD)

    print(cdist[1], "| ", '{:3.3f}'.format(rankM2SD),
        "| ", '{:3.3f}'.format(
            rankM3SD), "|", '{:3.3f}'.format(rankM2MAD),
        "| ", '{:3.3f}'.format(
            rankM3MAD), "|", '{:3.3f}'.format(rankM2IQD),
        "| ", '{:3.3f}'.format(rankM3IQD), "|")
```

## boring details
predominance of normal distribution :
https://trends.google.com/trends/explore?date=today%205-y&q=normal%20distribution,power%20law%20distribution,gamma%20distribution,exponential%20distribution


generated with 
Numpy version  1.18.1
Python version  3.8.1 

In appendix, extract of the code to produce the data is made available.

